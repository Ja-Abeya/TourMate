<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>대전 이벤트 목록</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 0;
            background-color: #f4f4f4;
        }
        h1 {
            text-align: center;
            color: #4CAF50;
        }
        .event {
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .event-title {
            font-size: 1.5em;
            margin: 0;
            color: #333;
        }
        .event-detail {
            margin: 5px 0;
            color: #555;
        }
        .event-detail strong {
            color: #333;
        }
        @media (max-width: 600px) {
            .event {
                padding: 10px;
            }
            .event-title {
                font-size: 1.3em;
            }
        }
    </style>
</head>
<body>
    <form id="dateSearchForm">
        <label for="startDate">시작일:</label>
        <input type="date" id="startDate" required>
        
        <label for="endDate">종료일:</label>
        <input type="date" id="endDate" required>
        
        <button type="submit">검색</button>
    </form>
    <h1>대전 이벤트 목록</h1>
    <div id="eventList"></div>


    <br>
    
    <div id="result"></div>

    <script>
        const apiUrl = "https://apis.data.go.kr/6300000/eventDataService/eventDataListJson?serviceKey=Jw2oAidGLR16SOZUB2qUKcDezPYS82ewHT2FBzPdaxCtaxyTCfSj9ZdsqtF0%2Fgylb78DE17RH%2B7Bafp2IIunOg%3D%3D&numOfRows=1000&pageNo=1";
        let events = [];

        fetch(apiUrl)
            .then(response => {
                if (!response.ok) {
                    throw new Error("네트워크 응답이 좋지 않습니다.");
                }
                return response.json();
            })
            .then(data => {
                if (data.msgBody) {
                    events = data.msgBody;
                    displayEvents(events); // 모든 이벤트 표시
                } else {
                    console.error("msgBody가 정의되지 않았습니다.");
                }
            })
            .catch(error => {
                console.error("오류 발생:", error);
            });

        function displayEvents(eventsToDisplay) {
            const eventList = document.getElementById("eventList");
            eventList.innerHTML = ''; // 기존 이벤트 목록 초기화

            if (eventsToDisplay.length === 0) {
                eventList.innerHTML = '<p>검색 결과가 없습니다.</p>';
            } else {
                eventsToDisplay.forEach(event => {
                    const eventDiv = document.createElement("div");
                    eventDiv.className = "event";

                    const title = document.createElement("h2");
                    title.className = "event-title";
                    title.textContent = event.title;

                    const contents = document.createElement("p");
                    contents.className = "event-detail";
                    contents.innerHTML = event.contents;

                    const beginTime = document.createElement("p");
                    beginTime.className = "event-detail";
                    beginTime.innerHTML = `<strong>시작 시간:</strong> ${event.beginTm}`;

                    const endTime = document.createElement("p");
                    endTime.className = "event-detail";
                    endTime.innerHTML = `<strong>종료 시간:</strong> ${event.endTm}`;

                    const place = document.createElement("p");
                    place.className = "event-detail";
                    place.innerHTML = `<strong>장소:</strong> ${event.placeDetail}`;

                    const startDate = document.createElement("p");
                    startDate.className = "event-detail";
                    startDate.innerHTML = `<strong>시작일:</strong> ${event.beginDt}`;

                    const endDate = document.createElement("p");
                    endDate.className = "event-detail";
                    endDate.innerHTML = `<strong>종료일:</strong> ${event.endDt}`;

                    eventDiv.appendChild(title);
                    eventDiv.appendChild(contents);
                    eventDiv.appendChild(beginTime);
                    eventDiv.appendChild(endTime);
                    eventDiv.appendChild(place);
                    eventDiv.appendChild(startDate);
                    eventDiv.appendChild(endDate);

                    eventList.appendChild(eventDiv);
                });
            }
        }

        document.getElementById('dateSearchForm').addEventListener('submit', function(event) {
            event.preventDefault(); // 기본 제출 방지

            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;

            // 입력값 검증
            if (new Date(startDate) > new Date(endDate)) {
                document.getElementById('result').innerText = '시작일은 종료일보다 앞서야 합니다.';
                displayEvents(events); // 원래 이벤트 목록 표시
            } else {
                const filteredEvents = events.filter(event => {
                    return event.beginDt >= startDate && event.endDt <= endDate;
                });
                displayEvents(filteredEvents);
                document.getElementById('result').innerText = `검색 기간: ${startDate} ~ ${endDate}`;
            }
        });
    </script>
</body>
</html>
